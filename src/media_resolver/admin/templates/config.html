{% extends "base.html" %}

{% block title %}Configuration - Media Resolver Admin{% endblock %}

{% block content %}
<div class="card">
    <h2>LLM Backend Selection</h2>
    <div id="config-result"></div>
    
    {% if config.llm.backends %}
    <form hx-post="/admin/config/update" hx-target="#config-result" hx-swap="innerHTML">
        <div class="form-group">
            <label for="active_backend">Active Backend</label>
            <select name="active_backend" id="active_backend">
                {% for backend in config.llm.backends %}
                <option value="{{ backend.name }}" {% if config.llm.active_backend == backend.name %}selected{% endif %}>
                    {{ backend.name }} ({{ backend.provider }} - {{ backend.model }})
                </option>
                {% endfor %}
            </select>
        </div>

        <button type="submit">
            Switch Backend
            <span class="htmx-indicator">‚è≥</span>
        </button>
    </form>
    
    <hr>
    
    <h3>Available Backends</h3>
    <div class="backend-list">
        {% for backend in config.llm.backends %}
        <div class="backend-item {% if config.llm.active_backend == backend.name %}active{% endif %}">
            <h4>{{ backend.name }} {% if config.llm.active_backend == backend.name %}(Active){% endif %}</h4>
            <ul>
                <li><strong>Provider:</strong> {{ backend.provider }}</li>
                <li><strong>Model:</strong> {{ backend.model }}</li>
                <li><strong>Temperature:</strong> {{ backend.temperature }}</li>
                <li><strong>Max Tokens:</strong> {{ backend.max_tokens }}</li>
                {% if backend.base_url %}
                <li><strong>Base URL:</strong> {{ backend.base_url }}</li>
                {% endif %}
            </ul>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="alert alert-warning">
        No LLM backends configured. Please add backends to your config.yaml file.
    </p>
    {% endif %}
</div>

<div class="card">
    <h2>Configuration Help</h2>
    <p>To add or modify backends, edit your <code>config/config.yaml</code> file:</p>
    <pre><code>llm:
  backends:
    - name: "claude-sonnet"
      provider: "anthropic"
      model: "claude-3-5-sonnet-20241022"
      temperature: 0.7
      max_tokens: 2000
    
    - name: "gpt-4"
      provider: "openai"
      model: "gpt-4-turbo-preview"
      temperature: 0.7
      max_tokens: 2000
  
  active_backend: "claude-sonnet"</code></pre>
    <p class="alert alert-info">
        API keys are set via environment variables (ANTHROPIC_API_KEY, OPENAI_API_KEY, etc.) and not displayed here for security.
    </p>
</div>

<div class="card">
    <h2>Current Configuration (Read-Only)</h2>
    <pre><code>{{ config.model_dump_json(indent=2, exclude={"llm": {"backends": {"__all__": {"api_key"}}}}) }}</code></pre>
</div>

<style>
.backend-list {
    display: grid;
    gap: 1rem;
    margin-top: 1rem;
}

.backend-item {
    padding: 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: #f9f9f9;
}

.backend-item.active {
    border-color: #4CAF50;
    background: #e8f5e9;
}

.backend-item h4 {
    margin-top: 0;
}

.backend-item ul {
    list-style: none;
    padding-left: 0;
}

.backend-item li {
    margin: 0.25rem 0;
}
</style>
{% endblock %}
